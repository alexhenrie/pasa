<!DOCTYPE html>
<html>
  <head>
    <link href="bootstrap.min.css" rel="stylesheet" type="text/css" />
    <style id="styleblock" type="text/css"></style>
    <meta charset="UTF-8"/>
    <!-- Raisin picture is CC-BY-SA-2.5 from Cary Bass, https://commons.wikimedia.org/wiki/File:Single_raisin.jpg -->
    <link rel="icon" type="image/png" href="favicon.png"/>
    <title>Generate password</title>
    <style type="text/css">
      h1 {
        font-weight: normal;
      }
      label {
        -moz-user-select: none;
        user-select: none;
      }
      input[type="number"],input[type="text"] {
        width: 150px;
      }
      form {
        padding-left: 18px;
      }
    </style>

    <script type="application/javascript">
      window.preferences = Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch);
      window.clipboard = Components.classes["@mozilla.org/widget/clipboardhelper;1"].getService(Components.interfaces.nsIClipboardHelper);
    </script>
  </head>
  <body class="container">
    <script type="application/javascript">//<![CDATA
    if (!preferences.getBoolPref("signon.rememberSignons"))
        document.write("<div id=\"remembersignons\">Firefox does not currently ask to remember passwords. <a href=\"javascript:preferences.setBoolPref('signon.rememberSignons', true); document.getElementById('remembersignons').parentNode.removeChild(document.getElementById('remembersignons')); undefined;\">Click here to fix that.</a></div>");
    if (!preferences.prefHasUserValue("services.sync.account"))
        document.write("<div>Your passwords saved in Firefox are not currently backed up via Firefox Sync because you are not currently signed in to Firefox Sync. <a href=\"about:accounts\">Sign in to Firefox Sync</a> to back up your passwords automatically.");
    if (preferences.prefHasUserValue("services.sync.engine.passwords"))
        document.write("<div id=\"syncsignons\">Your passwords saved in Firefox are not currently backed up via Firefox Sync because password sync is turned off. <a href=\"javascript:preferences.setBoolPref('services.sync.engine.passwords', true); document.getElementById('syncsignons').parentNode.removeChild(document.getElementById('syncsignons')); undefined;\">Click here to fix that.</a></div>");
    //]]></script>

    <div class="btn" style="font-size:x-large; float:right"><a href="chrome://passwordmgr/content/passwordManager.xul">View saved passwords</a></div>

    <h2>
      New random password:
      <div style="display:inline-block; font-family:monospace; position:relative">
        <div id="password" style="color:transparent; position:absolute; padding:0.5em 1em 0.5em 1em"></div>
        <div id="dots" style="padding:0.5em 1em 0.5em 1em"></div>
      </div>
      <a class="btn btn-lg btn-primary" href="javascript:clipboard.copyString(document.getElementById('password').textContent)">Copy to clipboard</a>
    </h2>

    <p>After setting your password for a website, sign out and sign back in to make sure that Firefox saved the password. If it is not saved anywhere else then once you leave or refresh this page, this password will be gone for good.</p>

    <h2>Generate another password:</h2>

    <form class="form-horizontal" action="" method="get">
      <div class="form-group">
        <div class="checkbox">
          <label for="miniscule">
            <input id="miniscule" name="miniscule" type="checkbox" checked="checked"/> Lowercase letters
          </label>
        </div>
      </div>

      <div class="form-group">
        <div class="checkbox">
          <label>
            <input id="majiscule" name="majiscule" type="checkbox" checked="checked"/> Uppercase letters
          </label>
        </div>
      </div>

      <div class="form-group">
        <div class="checkbox">
          <label>
            <input id="numbers" name="numbers" type="checkbox" checked="checked"/> Numbers
          </label>
        </div>
      </div>

      <div class="form-group">
        <div class="checkbox">
          <label>
            <input id="symbols" name="symbols" type="checkbox"/>
            Symbols:
          </label>
          <input id="oksymbols" class="form-control" name="oksymbols" type="text" value="-_." oninput="document.getElementById('symbols').checked = true;" style="margin-top: 4px;" />
        </div>
      </div>

      <div class="form-group">
        <div>
          Length:
          <input style="margin-top: 4px;" class="form-control" id="length" name="length" type="number" value="10"/>
        </div>
      </div>

      <input class="btn btn-primary btn-lg" type="submit" value="Generate"/>
    </form>

    <script type="application/javascript">//<![CDATA[
      var useDefaults = location.href.indexOf("?") == -1;

      var params = {};
      function applyCheckboxParam(name)
      {
          if (useDefaults)
          {
              params[name] = document.getElementById(name).checked;
          }
          else
          {
              params[name] = location.href.indexOf(name + "=on") != -1;
              document.getElementById(name).checked = params[name] ? true : false;
          }
      }
      applyCheckboxParam("miniscule");
      applyCheckboxParam("majiscule");
      applyCheckboxParam("numbers");
      applyCheckboxParam("symbols");

      var minisculePool = "abcdefghijklmnopqrstuvwxyz";
      var majisculePool = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      var numberPool = "0123456789";
      var symbolPool = decodeURIComponent((/oksymbols=([^&]+)/g.exec(location.href) || ["", ""])[1]);

      var charPool = "";
      if (params["miniscule"])
          charPool += minisculePool;
      if (params["majiscule"])
          charPool += majisculePool;
      if (params["numbers"])
          charPool += numberPool;
      if (params["symbols"])
          charPool += symbolPool;

      if (symbolPool)
      {
          document.getElementById("oksymbols").value = symbolPool;
      }

      var length = (/length=([^&]+)/g.exec(location.href) || ["", ""])[1];
      if (length)
          document.getElementById("length").value = length;
      length = document.getElementById("length").value;

      var password;
      do
      {
          password = "";
          for (var i = 0; i < length; i++)
          {
              password += charPool[Math.floor(Math.random() * charPool.length)];
          }
      }
      while ((params["miniscule"] && !(new RegExp("[" + minisculePool + "]", "g")).exec(password)) ||
             (params["majiscule"] && !(new RegExp("[" + majisculePool + "]", "g")).exec(password)) ||
             (params["numbers"] && !(new RegExp("[" + numberPool + "]", "g")).exec(password)) ||
             (params["symbols"] && symbolPool && !(new RegExp("[" + symbolPool.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1") + "]", "g")).exec(password)))

      document.getElementById("styleblock").textContent = "#dots:after{content:'" + new Array(password.length + 1).join("●") + "'}";
      document.getElementById("password").textContent = password;
      //]]>
    </script>
  </body>
</html>
